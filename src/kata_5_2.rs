use std::collections::HashMap;

pub fn decomp(n: i32) -> String {
    let mut prime_all = vec![2, 3, 5, 7];
    for i in (11..=n/2).step_by(2) {
        if i % 2 == 0 || i % 3 == 0 || i % 5 == 0 || i % 7 == 0 {
            continue;
        };

        prime_all.push(i);
    }
    let prime_last = prime_all[prime_all.len() - 1];

    let mut primes_count: HashMap<i32, i32> = HashMap::new();
    for num in 2..=n {
        let mut k = num;
        while k != 0 {

            if k == 1 { break }

            for prime in prime_all.iter() {
                let modulo = k % prime;
                if modulo == 0 {
                    increment_hashmap(&mut primes_count, *prime);
                    k = k / prime;
                    break
                }

                if *prime == prime_last {
                    increment_hashmap(&mut primes_count, k);
                    k = 1;
                }
            }
        }
    }

    let mut primes_count_sorted: Vec<_> = primes_count.iter().collect();
    primes_count_sorted.sort_by_key(|a| a.0);

    let mut result = String::new();
    for (num, count) in primes_count_sorted {
        if *count == 1 {
            result = format!("{} * {}", result, num);
        } else {
            result = format!("{} * {}^{}", result, num, count);
        }
    }

    result = format!("{}", &result.trim()[2..]);
 
    result
}

pub fn increment_hashmap(map: &mut HashMap<i32, i32>, v: i32) {
    match map.get(&v) {
        Some(count) => {
            map.insert(v, count + 1);
        }
        None => {
            map.insert(v, 1);
        }
    }
}

#[cfg(test)]
    mod tests {
    use super::*;
   
    fn dotest(n: i32, exp: &str) -> () {
        println!("n:{:?}", n);
        let ans = decomp(n);
        println!("actual: {:?}", ans);
        println!("expect: {:?}", exp.to_string());
        println!("{}", ans == exp.to_string());
        assert_eq!(ans, exp.to_string());
        println!("{}", "-");
    }
    
    #[test]
    fn basic_tests() {
        dotest(17, "2^15 * 3^6 * 5^3 * 7^2 * 11 * 13 * 17");
        dotest(5, "2^3 * 3 * 5");
        dotest(22, "2^19 * 3^9 * 5^4 * 7^3 * 11^2 * 13 * 17 * 19");
        dotest(14, "2^11 * 3^5 * 5^2 * 7^2 * 11 * 13");
        dotest(25, "2^22 * 3^10 * 5^6 * 7^3 * 11^2 * 13 * 17 * 19 * 23");

    }    
}

// Source: https://www.codewars.com/kata/5a045fee46d843effa000070
// cargo test -- kata_5_2 --nocapture

// n:3316
// actual: "2^3309 * 3^1653 * 5^827 * 7^550 * 11^82 * 13^76 * 17^65 * 19^61 * 23^56 * 29^49 * 31^47 * 37^42 * 41^40 * 43^39 * 47^37 * 53^34 * 59^33 * 61^32 * 67^30 * 71^28 * 73^28 * 79^26 * 83^25 * 89^25 * 97^23 * 101^23 * 103^23 * 107^22 * 109^22 * 113^21 * 121^20 * 127^19 * 131^19 * 137^18 * 139^17 * 143^17 * 149^17 * 151^17 * 157^17 * 163^16 * 167^15 * 169^15 * 173^15 * 179^15 * 181^15 * 187^14 * 191^14 * 193^14 * 197^14 * 199^14 * 209^13 * 211^13 * 221^13 * 223^12 * 227^12 * 229^12 * 233^12 * 239^11 * 241^11 * 247^11 * 251^11 * 253^11 * 257^11 * 263^11 * 269^11 * 271^11 * 277^10 * 281^10 * 283^10 * 289^10 * 293^10 * 299^10 * 307^10 * 311^10 * 313^10 * 317^10 * 319^10 * 323^10 * 331^10 * 337^9 * 341^9 * 347^9 * 349^9 * 353^9 * 359^9 * 361^9 * 367^9 * 373^8 * 377^8 * 379^8 * 383^8 * 389^8 * 391^8 * 397^8 * 401^8 * 403^8 * 407^8 * 409^8 * 419^7 * 421^7 * 431^7 * 433^7 * 437^7 * 439^7 * 443^7 * 449^7 * 451^7 * 457^7 * 461^7 * 463^7 * 467^7 * 473^7 * 479^6 * 481^6 * 487^6 * 491^6 * 493^6 * 499^6 * 503^6 * 509^6 * 517^6 * 521^6 * 523^6 * 527^6 * 529^6 * 533^6 * 541^6 * 547^6 * 551^6 * 557^5 * 559^5 * 563^5 * 569^5 * 571^5 * 577^5 * 583^5 * 587^5 * 589^5 * 593^5 * 599^5 * 601^5 * 607^5 * 611^5 * 613^5 * 617^5 * 619^5 * 629^5 * 631^5 * 641^5 * 643^5 * 647^5 * 649^5 * 653^5 * 659^5 * 661^5 * 667^4 * 671^4 * 673^4 * 677^4 * 683^4 * 689^4 * 691^4 * 697^4 * 701^4 * 703^4 * 709^4 * 713^4 * 719^4 * 727^4 * 731^4 * 733^4 * 737^4 * 739^4 * 743^4 * 751^4 * 757^4 * 761^4 * 767^4 * 769^4 * 773^4 * 779^4 * 781^4 * 787^4 * 793^4 * 797^4 * 799^4 * 803^4 * 809^4 * 811^4 * 817^4 * 821^4 * 823^4 * 827^4 * 829^4 * 839^3 * 841^3 * 851^3 * 853^3 * 857^3 * 859^3 * 863^3 * 869^3 * 871^3 * 877^3 * 881^3 * 883^3 * 887^3 * 893^3 * 899^3 * 901^3 * 907^3 * 911^3 * 913^3 * 919^3 * 923^3 * 929^3 * 937^3 * 941^3 * 943^3 * 947^3 * 949^3 * 953^3 * 961^3 * 967^3 * 971^3 * 977^3 * 979^3 * 983^3 * 989^3 * 991^3 * 997^3 * 1003^3 * 1007^3 * 1009^3 * 1013^3 * 1019^3 * 1021^3 * 1027^3 * 1031^3 * 1033^3 * 1037^3 * 1039^3 * 1049^3 * 1051^3 * 1061^3 * 1063^3 * 1067^3 * 1069^3 * 1073^3 * 1079^3 * 1081^3 * 1087^3 * 1091^3 * 1093^3 * 1097^3 * 1103^3 * 1109^2 * 1111^2 * 1117^2 * 1121^2 * 1123^2 * 1129^2 * 1133^2 * 1139^2 * 1147^2 * 1151^2 * 1153^2 * 1157^2 * 1159^2 * 1163^2 * 1171^2 * 1177^2 * 1181^2 * 1187^2 * 1189^2 * 1193^2 * 1199^2 * 1201^2 * 1207^2 * 1213^2 * 1217^2 * 1219^2 * 1223^2 * 1229^2 * 1231^2 * 1237^2 * 1241^2 * 1243^2 * 1247^2 * 1249^2 * 1259^2 * 1261^2 * 1271^2 * 1273^2 * 1277^2 * 1279^2 * 1283^2 * 1289^2 * 1291^2 * 1297^2 * 1301^2 * 1303^2 * 1307^2 * 1313^2 * 1319^2 * 1321^2 * 1327^2 * 1331^2 * 1333^2 * 1339^2 * 1343^2 * 1349^2 * 1357^2 * 1361^2 * 1363^2 * 1367^2 * 1369^2 * 1373^2 * 1381^2 * 1387^2 * 1391^2 * 1397^2 * 1399^2 * 1403^2 * 1409^2 * 1411^2 * 1417^2 * 1423^2 * 1427^2 * 1429^2 * 1433^2 * 1439^2 * 1441^2 * 1447^2 * 1451^2 * 1453^2 * 1457^2 * 1459^2 * 1469^2 * 1471^2 * 1481^2 * 1483^2 * 1487^2 * 1489^2 * 1493^2 * 1499^2 * 1501^2 * 1507^2 * 1511^2 * 1513^2 * 1517^2 * 1523^2 * 1529^2 * 1531^2 * 1537^2 * 1541^2 * 1543^2 * 1549^2 * 1553^2 * 1559^2 * 1567^2 * 1571^2 * 1573^2 * 1577^2 * 1579^2 * 1583^2 * 1591^2 * 1597^2 * 1601^2 * 1607^2 * 1609^2 * 1613^2 * 1619^2 * 1621^2 * 1627^2 * 1633^2 * 1637^2 * 1639^2 * 1643^2 * 1649^2 * 1651^2 * 1657^2 * 1661 * 1663 * 1667 * 1669 * 1679 * 1681 * 1691 * 1693 * 1697 * 1699 * 1703 * 1709 * 1711 * 1717 * 1721 * 1723 * 1727 * 1733 * 1739 * 1741 * 1747 * 1751 * 1753 * 1759 * 1763 * 1769 * 1777 * 1781 * 1783 * 1787 * 1789 * 1793 * 1801 * 1807 * 1811 * 1817 * 1819 * 1823 * 1829 * 1831 * 1837 * 1843 * 1847 * 1849 * 1853 * 1859 * 1861 * 1867 * 1871 * 1873 * 1877 * 1879 * 1889 * 1891 * 1901 * 1903 * 1907 * 1909 * 1913 * 1919 * 1921 * 1927 * 1931 * 1933 * 1937 * 1943 * 1949 * 1951 * 1957 * 1961 * 1963 * 1969 * 1973 * 1979 * 1987 * 1991 * 1993 * 1997 * 1999 * 2003 * 2011 * 2017 * 2021 * 2027 * 2029 * 2033 * 2039 * 2041 * 2047 * 2053 * 2057 * 2059 * 2063 * 2069 * 2071 * 2077 * 2081 * 2083 * 2087 * 2089 * 2099 * 2101 * 2111 * 2113 * 2117 * 2119 * 2123 * 2129 * 2131 * 2137 * 2141 * 2143 * 2147 * 2153 * 2159 * 2161 * 2167 * 2171 * 2173 * 2179 * 2183 * 2189 * 2197 * 2201 * 2203 * 2207 * 2209 * 2213 * 2221 * 2227 * 2231 * 2237 * 2239 * 2243 * 2249 * 2251 * 2257 * 2263 * 2267 * 2269 * 2273 * 2279 * 2281 * 2287 * 2291 * 2293 * 2297 * 2299 * 2309 * 2311 * 2321 * 2323 * 2327 * 2329 * 2333 * 2339 * 2341 * 2347 * 2351 * 2353 * 2357 * 2363 * 2369 * 2371 * 2377 * 2381 * 2383 * 2389 * 2393 * 2399 * 2407 * 2411 * 2413 * 2417 * 2419 * 2423 * 2431 * 2437 * 2441 * 2447 * 2449 * 2453 * 2459 * 2461 * 2467 * 2473 * 2477 * 2479 * 2483 * 2489 * 2491 * 2497 * 2501 * 2503 * 2507 * 2509 * 2519 * 2521 * 2531 * 2533 * 2537 * 2539 * 2543 * 2549 * 2551 * 2557 * 2561 * 2563 * 2567 * 2573 * 2579 * 2581 * 2587 * 2591 * 2593 * 2599 * 2603 * 2609 * 2617 * 2621 * 2623 * 2627 * 2629 * 2633 * 2641 * 2647 * 2651 * 2657 * 2659 * 2663 * 2669 * 2671 * 2677 * 2683 * 2687 * 2689 * 2693 * 2699 * 2701 * 2707 * 2711 * 2713 * 2717 * 2719 * 2729 * 2731 * 2741 * 2743 * 2747 * 2749 * 2753 * 2759 * 2761 * 2767 * 2771 * 2773 * 2777 * 2783 * 2789 * 2791 * 2797 * 2801 * 2803 * 2809 * 2813 * 2819 * 2827 * 2831 * 2833 * 2837 * 2839 * 2843 * 2851 * 2857 * 2861 * 2867 * 2869 * 2873 * 2879 * 2881 * 2887 * 2893 * 2897 * 2899 * 2903 * 2909 * 2911 * 2917 * 2921 * 2923 * 2927 * 2929 * 2939 * 2941 * 2951 * 2953 * 2957 * 2959 * 2963 * 2969 * 2971 * 2977 * 2981 * 2983 * 2987 * 2993 * 2999 * 3001 * 3007 * 3011 * 3013 * 3019 * 3023 * 3029 * 3037 * 3041 * 3043 * 3047 * 3049 * 3053 * 3061 * 3067 * 3071 * 3077 * 3079 * 3083 * 3089 * 3091 * 3097 * 3103 * 3107 * 3109 * 3113 * 3119 * 3121 * 3127 * 3131 * 3133 * 3137 * 3139 * 3149 * 3151 * 3161 * 3163 * 3167 * 3169 * 3173 * 3179 * 3181 * 3187 * 3191 * 3193 * 3197 * 3203 * 3209 * 3211 * 3217 * 3221 * 3223 * 3229 * 3233 * 3239 * 3247 * 3251 * 3253 * 3257 * 3259 * 3263 * 3271 * 3277 * 3281 * 3287 * 3289 * 3293 * 3299 * 3301 * 3307 * 3313"
// expect: "2^3309 * 3^1653 * 5^827 * 7^550 * 11^330 * 13^275 * 17^206 * 19^183 * 23^150 * 29^117 * 31^109 * 37^91 * 41^81 * 43^78 * 47^71 * 53^63 * 59^56 * 61^54 * 67^49 * 71^46 * 73^45 * 79^41 * 83^39 * 89^37 * 97^34 * 101^32 * 103^32 * 107^30 * 109^30 * 113^29 * 127^26 * 131^25 * 137^24 * 139^23 * 149^22 * 151^21 * 157^21 * 163^20 * 167^19 * 173^19 * 179^18 * 181^18 * 191^17 * 193^17 * 197^16 * 199^16 * 211^15 * 223^14 * 227^14 * 229^14 * 233^14 * 239^13 * 241^13 * 251^13 * 257^12 * 263^12 * 269^12 * 271^12 * 277^11 * 281^11 * 283^11 * 293^11 * 307^10 * 311^10 * 313^10 * 317^10 * 331^10 * 337^9 * 347^9 * 349^9 * 353^9 * 359^9 * 367^9 * 373^8 * 379^8 * 383^8 * 389^8 * 397^8 * 401^8 * 409^8 * 419^7 * 421^7 * 431^7 * 433^7 * 439^7 * 443^7 * 449^7 * 457^7 * 461^7 * 463^7 * 467^7 * 479^6 * 487^6 * 491^6 * 499^6 * 503^6 * 509^6 * 521^6 * 523^6 * 541^6 * 547^6 * 557^5 * 563^5 * 569^5 * 571^5 * 577^5 * 587^5 * 593^5 * 599^5 * 601^5 * 607^5 * 613^5 * 617^5 * 619^5 * 631^5 * 641^5 * 643^5 * 647^5 * 653^5 * 659^5 * 661^5 * 673^4 * 677^4 * 683^4 * 691^4 * 701^4 * 709^4 * 719^4 * 727^4 * 733^4 * 739^4 * 743^4 * 751^4 * 757^4 * 761^4 * 769^4 * 773^4 * 787^4 * 797^4 * 809^4 * 811^4 * 821^4 * 823^4 * 827^4 * 829^4 * 839^3 * 853^3 * 857^3 * 859^3 * 863^3 * 877^3 * 881^3 * 883^3 * 887^3 * 907^3 * 911^3 * 919^3 * 929^3 * 937^3 * 941^3 * 947^3 * 953^3 * 967^3 * 971^3 * 977^3 * 983^3 * 991^3 * 997^3 * 1009^3 * 1013^3 * 1019^3 * 1021^3 * 1031^3 * 1033^3 * 1039^3 * 1049^3 * 1051^3 * 1061^3 * 1063^3 * 1069^3 * 1087^3 * 1091^3 * 1093^3 * 1097^3 * 1103^3 * 1109^2 * 1117^2 * 1123^2 * 1129^2 * 1151^2 * 1153^2 * 1163^2 * 1171^2 * 1181^2 * 1187^2 * 1193^2 * 1201^2 * 1213^2 * 1217^2 * 1223^2 * 1229^2 * 1231^2 * 1237^2 * 1249^2 * 1259^2 * 1277^2 * 1279^2 * 1283^2 * 1289^2 * 1291^2 * 1297^2 * 1301^2 * 1303^2 * 1307^2 * 1319^2 * 1321^2 * 1327^2 * 1361^2 * 1367^2 * 1373^2 * 1381^2 * 1399^2 * 1409^2 * 1423^2 * 1427^2 * 1429^2 * 1433^2 * 1439^2 * 1447^2 * 1451^2 * 1453^2 * 1459^2 * 1471^2 * 1481^2 * 1483^2 * 1487^2 * 1489^2 * 1493^2 * 1499^2 * 1511^2 * 1523^2 * 1531^2 * 1543^2 * 1549^2 * 1553^2 * 1559^2 * 1567^2 * 1571^2 * 1579^2 * 1583^2 * 1597^2 * 1601^2 * 1607^2 * 1609^2 * 1613^2 * 1619^2 * 1621^2 * 1627^2 * 1637^2 * 1657^2 *                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        1663 * 1667 * 1669 * 1693 * 1697 * 1699 * 1709 * 1721 * 1723 * 1733 * 1741 * 1747 * 1753 * 1759 * 1777 * 1783 * 1787 * 1789 * 1801 * 1811 * 1823 * 1831 * 1847 * 1861 * 1867 * 1871 * 1873 * 1877 * 1879 * 1889 * 1901 * 1907 * 1913 * 1931 * 1933 * 1949 * 1951 * 1973 * 1979 * 1987 * 1993 * 1997 * 1999 * 2003 * 2011 * 2017 * 2027 * 2029 * 2039 * 2053 * 2063 * 2069 * 2081 * 2083 * 2087 * 2089 * 2099 * 2111 * 2113 * 2129 * 2131 * 2137 * 2141 * 2143 * 2153 * 2161 * 2179 * 2203 * 2207 * 2213 * 2221 * 2237 * 2239 * 2243 * 2251 * 2267 * 2269 * 2273 * 2281 * 2287 * 2293 * 2297 * 2309 * 2311 * 2333 * 2339 * 2341 * 2347 * 2351 * 2357 * 2371 * 2377 * 2381 * 2383 * 2389 * 2393 * 2399 * 2411 * 2417 * 2423 * 2437 * 2441 * 2447 * 2459 * 2467 * 2473 * 2477 * 2503 * 2521 * 2531 * 2539 * 2543 * 2549 * 2551 * 2557 * 2579 * 2591 * 2593 * 2609 * 2617 * 2621 * 2633 * 2647 * 2657 * 2659 * 2663 * 2671 * 2677 * 2683 * 2687 * 2689 * 2693 * 2699 * 2707 * 2711 * 2713 * 2719 * 2729 * 2731 * 2741 * 2749 * 2753 * 2767 * 2777 * 2789 * 2791 * 2797 * 2801 * 2803 * 2819 * 2833 * 2837 * 2843 * 2851 * 2857 * 2861 * 2879 * 2887 * 2897 * 2903 * 2909 * 2917 * 2927 * 2939 * 2953 * 2957 * 2963 * 2969 * 2971 * 2999 * 3001 * 3011 * 3019 * 3023 * 3037 * 3041 * 3049 * 3061 * 3067 * 3079 * 3083 * 3089 * 3109 * 3119 * 3121 * 3137 * 3163 * 3167 * 3169 * 3181 * 3187 * 3191 * 3203 * 3209 * 3217 * 3221 * 3229 * 3251 * 3253 * 3257 * 3259 * 3271 * 3299 * 3301 * 3307 * 3313"